# sources:
#   getLatestAmi:
#     plugin: aws/ami
#     kind: aws/ami
#     spec:
#       region: ap-south-1 
#       filters:
#         - name: "tag:my-ami"
#           values: "khush" 
#       sortby: creationDateDesc
  
# targets:
#   updateAmiInConfig:
#     name: Update AWS AMI in config.json
#     kind: json
#     sourceid: getLatestAmi
#     spec:
#       file: /home/ncs/updatecli/input.json
#       key: firstName  

scms:
  setupgitscm:
    kind: github
    spec:
      user: "khushpardhi"
      owner: "khushpardhi"
      repository: "wanderlust"
      token: "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"
      branch: "main"
      commitmessage:
        message: "chore: update AMI IDs in nxio.json and hosting.json"

sources:
  getLatestAmi:
    plugin: aws/ami
    kind: aws/ami
    spec:
      region: ap-south-1 
      filters:
        - name: "tag:my-ami"
          values: "khush" 
      sortby: creationDateDesc
  
targets:
  updateAmiInConfig:
    name: Update AWS AMI in config.json
    scmid: setupgitscm
    kind: json
    sourceid: getLatestAmi
    spec:
      file: /home/ncs/updatecli/input.json
      key: firstName  

actions:
  create_pull_request:
    kind: github/pullrequest
    scmid: setupgitscm
    targets: updateAmiInConfig
    spec:
      automerge: false
      description: "Update hosting and nxio security AMI"
      draft: false
      title: "chore: update AMI IDs in nxio.json and hosting.json"



