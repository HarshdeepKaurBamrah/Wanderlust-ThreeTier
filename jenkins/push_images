node {
    parameters {
        string(name: 'BRANCH_NAME', defaultValue: 'main', description: 'Git branch to pull')
        string(name: 'giturl', defaultValue: 'https://github.com/khushpardhi/wanderlust.git', description: 'cloning the code from github')
}
    try {
        stage("Clone Code") {
            cleanWs()
            git url: "${params.giturl}", branch: "${params.BRANCH_NAME}"
        }

        stage("Login to DockerHub") {
            withCredentials([usernamePassword(credentialsId: "dockerHub", passwordVariable: "dockerHubPass", usernameVariable: "dockerHubUser")]) {
                sh "docker login -u ${env.dockerHubUser} -p ${env.dockerHubPass}"
            }
        }

        stage("Build Docker Images with Docker Compose") {
            echo "Building Docker images using docker-compose..."
            sh "docker-compose build"
        }

        stage("Push Docker Images to DockerHub") {
            def DOCKER_IMAGES = [
                "khushpardhi/backend:latest",
                "khushpardhi/frontend:latest"
            ]
            for (image in DOCKER_IMAGES) {
                echo "Pushing Docker image: ${image}"
                sh "docker push ${image}"
            }
        }
    } catch (Exception e) {
        currentBuild.result = "FAILURE"
        throw e
    }
}
